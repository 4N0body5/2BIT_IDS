/* ********* len pre vyhnutie sa znovu-vytvoreniu pri opakovanom pusteni *********** */
drop table liek;

drop table liek_na_predpis;
drop table liek_bez_predpisu;
drop table pobocka;
drop table poistovna;

drop table mnozstvo;
drop table vyska_prispevku;
drop table vydany_liek;

purge recyclebin;
/* ********************************************************************************* */

/*  prva varianta implementacie specializacie pretoze typ lieku na predpis a bez predpisu sa prekryva  */
create table liek (
    kod_lieku number(13,0) primary key,
    nazov varchar(255),
    popis varchar(255),
    cena number(10,2)
    /*nutnost_predpisu varchar(11) check (nutnost_predpisu in ('na predpis','bez predpis')), ** asi skor pre tretiu variantu **/
);

create table liek_na_predpis (
    kod_lieku number(13,0) primary key references liek(kod_lieku),
    cena_s_prispevkom number(10,2)
);

create table liek_bez_predpisu (
    kod_lieku number(13,0) primary key references liek(kod_lieku)
);


create table pobocka (
    id_pobocky int generated by default as identity primary key,
    /*adresa varchar(255),*/
    ulica varchar(255), mesto varchar(255), psc number(5,0),
    telefon varchar(13)
);

create table mnozstvo (
    kod_lieku number(13,0),
    id_pobocky int,
    mnozstvo int check(mnozstvo >= 0),
    primary key (kod_lieku, id_pobocky),
    foreign key (kod_lieku) references liek(kod_lieku),
    foreign key (id_pobocky) references pobocka(id_pobocky)
);

create table poistovna (
    kod_poistovne number(2,0) primary key,
    nazov varchar(255),
    email varchar(255),
    telefon varchar(13)
);

create table vyska_prispevku (
    kod_lieku number(13,0),
    kod_poistovne int,
    vyska_prispevku number(10,2) check(vyska_prispevku >= 0),
    primary key (kod_lieku, kod_poistovne),
    foreign key (kod_lieku) references liek(kod_lieku),
    foreign key (kod_poistovne) references poistovna(kod_poistovne)
);

create table vydany_liek (
    id_vydaneho_lieku int generated by default as identity primary key,
    datum_vydania date,
    kod_lieku_bez_predpisu number(13,0) references liek_bez_predpisu(kod_lieku), /*make nullable?*/
    kod_lieku_na_predpis number(13,0) references liek_na_predpis(kod_lieku), /*make nullable?*/
    kod_poistovne number(2,0) references poistovna(kod_poistovne), /* check dependency on kod_lieku_na_predpis */
    kod_pobocky int references pobocka(id_pobocky)
);

/*

 todo:
 * skontrolovat vztahy, obmedzenia a ostatne vlastnosti..
 * doplnit ukazkove data
 * podm.: v tabulkach alespoň jeden sloupec se speciálním omezením hodnot (RČ, IČ, IČPE, ISBN, ISSN atp.), treba povolit pouze platné hodnoty (pomocí CHECK integritního omezení).
 * skontrolovat implementaciu specializacie
 * generovanie ID ak bude PK NULL??

 */